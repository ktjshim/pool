= = = = = = = = = = = = = = = = = = = =
## Starting Time: 09-11 11:24:16
Namespace(dataset='huggingface', llm='Mistral-7B', llm_model_path='', seed=0, device='cuda:0', max_txt_length=512, max_ans_length=512, gnn_in_dim=1024, gnn_hidden_dim=1024, gnn_output_dim=4096, n_layers=2, gnn_type='SAGE', max_degree=300, num_epochs=2, batch_size=6, eval_batch_size=6, patience=2, lr=1e-05, wd=0.05, output_dir='output', grad_steps=4, name='node')

[Training Data] # Chain Samples 1536 (51.20)
[Data Split] # Train 3000  # Test 500
# Train 2400   # Val 600   # Test 500
Loading checkpoint shards: 100%|██████████████████████████| 3/3 [00:01<00:00,  2.14it/s]
Finish loading pre-trained Mistral-7B model!
Trainable params 10492928 || all params 7252225024 || trainable% 0.14469
/nas/home/ktshim/tool/pool/graphtoken/../utils/datautil.py:24: RuntimeWarning: divide by zero encountered in power
  d_inv = np.power(row_sum, -0.5).flatten()
/nas/home/ktshim/tool/pool/graphtoken/../utils/datautil.py:19: UserWarning: torch.sparse.SparseTensor(indices, values, shape, *, device=) is deprecated.  Please use torch.sparse_coo_tensor(indices, values, shape, dtype=, device=). (Triggered internally at /pytorch/torch/csrc/utils/tensor_new.cpp:653.)
  return torch.sparse.FloatTensor(index, data, torch.Size(coo.shape))
  0%|                                                           | 0/800 [00:00<?, ?it/s]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`.
  0%|                                                 | 1/800 [00:35<7:54:41, 35.65s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  0%|                                                | 2/800 [01:31<10:34:32, 47.71s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  0%|▏                                                | 3/800 [01:32<5:47:39, 26.17s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  0%|▏                                                | 4/800 [01:32<3:32:47, 16.04s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  1%|▎                                                | 5/800 [01:33<2:18:10, 10.43s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  1%|▎                                                | 6/800 [01:33<1:32:58,  7.03s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  1%|▍                                                | 7/800 [01:34<1:04:34,  4.89s/it]/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
  1%|▌                                                  | 8/800 [01:34<46:00,  3.49s/it]W0911 12:25:55.100000 3575121 torch/_dynamo/convert_frame.py:1016] [0/8] torch._dynamo hit config.recompile_limit (8)
W0911 12:25:55.100000 3575121 torch/_dynamo/convert_frame.py:1016] [0/8]    function: 'forward' (/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:82)
W0911 12:25:55.100000 3575121 torch/_dynamo/convert_frame.py:1016] [0/8]    last reason: 0/7: samples['request'][0] == '# TASK LIST #:\nToken Classification, Translation, Summarization, Question Answering, Conversational, Text Generation, Sentence Similarity, Tabular Classification, Object Detection, Image Classification, Image-to-Image, Image-to-Text, Text-to-Image, Text-to-Video, Visual Question Answering, Document Question Answering, Image Segmentation, Depth Estimation, Text-to-Speech, Automatic Speech Recognition, Audio-to-Audio, Audio Classification, Image Editing\n\n# GOAL #\nPlease understand the user\'s request and generate task steps and task invocation graph to solve it.\n\n# REQUIREMENT #\n1. The format must in a strict JSON format as {"task_steps": [ concrete step descriptions ], "task_nodes": [ a list of tasks to be executed in sequence to fulfill user\'s request ], "task_links": [{"source": "task name i", "target": "task name j"}]}\n2. The generated task steps and task nodes can resolve the given user request perfectly. Task name must be selected from TASK LIST.\n3. Task steps should strictly aligned with task nodes, and the number of task steps should be same with the task nodes.\n4. The task links should reflect the dependencies among task nodes, i.e. the order in which the APIs are invoked.\n\n\n# USER REQUEST #: Please help me classify tokens in the following text: \'Alice went to the store at 3pm yesterday. She bought a cake and six candles.\'\nNow please generate your result in a strict JSON format:\n# RESULT #:'
W0911 12:25:55.100000 3575121 torch/_dynamo/convert_frame.py:1016] [0/8] To log all recompilation reasons, use TORCH_LOGS="recompiles".
W0911 12:25:55.100000 3575121 torch/_dynamo/convert_frame.py:1016] [0/8] To diagnose recompilation issues, see https://pytorch.org/docs/main/torch.compiler_troubleshooting.html.
/nas/home/ktshim/tool/pool/graphtoken/glm_node.py:78: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return torch.cuda.amp.autocast(dtype=dtype)
 25%|████████████▎                                    | 200/800 [03:09<04:42,  2.12it/s]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.

--- Running Inference Check at Step 200 ---
 50%|████████████████████████▌                        | 400/800 [04:54<03:28,  1.92it/s]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.

--- Running Inference Check at Step 400 ---
Epoch 0|2: Train Loss (Epoch Mean): 0.4908312860503793
Epoch: 0|2: Val Loss: 0.36780731201171873
Saving checkpoint at epoch 0 to output/huggingface/Mistral-7B/SAGE_Epoch2_checkpoint_best.pth
 75%|████████████████████████████████████▊            | 600/800 [07:08<01:35,  2.10it/s]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.

--- Running Inference Check at Step 200 ---
100%|█████████████████████████████████████████████████| 800/800 [08:58<00:00,  2.02it/s]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.

--- Running Inference Check at Step 400 ---
Epoch 1|2: Train Loss (Epoch Mean): 0.31903056748211384
Epoch: 1|2: Val Loss: 0.3283102130889893
Saving checkpoint at epoch 1 to output/huggingface/Mistral-7B/SAGE_Epoch2_checkpoint_best.pth
/home/ktshim/.local/lib/python3.12/site-packages/torch/cuda/memory.py:491: FutureWarning: torch.cuda.reset_max_memory_allocated now calls torch.cuda.reset_peak_memory_stats, which resets /all/ peak memory stats.
  warnings.warn(
Loading checkpoint from output/huggingface/Mistral-7B/SAGE_Epoch2_checkpoint_best.pth
                                                                                        Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  0%|                                                            | 0/84 [00:00<?, ?it/s]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  1%|▌                                                   | 1/84 [00:11<16:26, 11.88s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  2%|█▏                                                  | 2/84 [00:22<15:09, 11.09s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  4%|█▊                                                  | 3/84 [00:39<18:24, 13.63s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  5%|██▍                                                 | 4/84 [00:49<16:18, 12.23s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  6%|███                                                 | 5/84 [00:58<14:42, 11.18s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  7%|███▋                                                | 6/84 [01:12<15:40, 12.06s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
  8%|████▎                                               | 7/84 [01:22<14:36, 11.38s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 10%|████▉                                               | 8/84 [01:32<13:53, 10.96s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 11%|█████▌                                              | 9/84 [01:39<12:09,  9.72s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 12%|██████                                             | 10/84 [01:50<12:42, 10.30s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 13%|██████▋                                            | 11/84 [01:58<11:36,  9.55s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 14%|███████▎                                           | 12/84 [02:06<10:56,  9.12s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 15%|███████▉                                           | 13/84 [02:19<12:12, 10.31s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 17%|████████▌                                          | 14/84 [02:29<11:56, 10.23s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 18%|█████████                                          | 15/84 [02:42<12:30, 10.87s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 19%|█████████▋                                         | 16/84 [02:54<12:38, 11.15s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 20%|██████████▎                                        | 17/84 [03:03<11:52, 10.64s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 21%|██████████▉                                        | 18/84 [03:19<13:35, 12.36s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 23%|███████████▌                                       | 19/84 [03:29<12:36, 11.63s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 24%|████████████▏                                      | 20/84 [03:42<12:39, 11.87s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 25%|████████████▊                                      | 21/84 [03:49<11:03, 10.53s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 26%|█████████████▎                                     | 22/84 [03:58<10:19, 10.00s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 27%|█████████████▉                                     | 23/84 [04:10<10:56, 10.77s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 29%|██████████████▌                                    | 24/84 [04:23<11:17, 11.29s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 30%|███████████████▏                                   | 25/84 [04:32<10:26, 10.62s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 31%|███████████████▊                                   | 26/84 [04:48<11:44, 12.14s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 32%|████████████████▍                                  | 27/84 [04:59<11:09, 11.75s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 33%|█████████████████                                  | 28/84 [05:11<11:05, 11.89s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 35%|█████████████████▌                                 | 29/84 [05:23<10:57, 11.96s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 36%|██████████████████▏                                | 30/84 [05:36<11:00, 12.23s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 37%|██████████████████▊                                | 31/84 [05:47<10:34, 11.97s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
[Test Error] Test-ID 75616216 e pred
 38%|███████████████████▍                               | 32/84 [06:06<12:13, 14.11s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 39%|████████████████████                               | 33/84 [06:20<12:01, 14.15s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 40%|████████████████████▋                              | 34/84 [06:30<10:33, 12.66s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 42%|█████████████████████▎                             | 35/84 [06:39<09:25, 11.55s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 43%|█████████████████████▊                             | 36/84 [06:48<08:45, 10.94s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 44%|██████████████████████▍                            | 37/84 [06:59<08:30, 10.86s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 45%|███████████████████████                            | 38/84 [07:08<08:01, 10.47s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 46%|███████████████████████▋                           | 39/84 [07:20<08:11, 10.92s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 48%|████████████████████████▎                          | 40/84 [07:30<07:39, 10.45s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 49%|████████████████████████▉                          | 41/84 [07:43<08:00, 11.18s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 50%|█████████████████████████▌                         | 42/84 [07:56<08:21, 11.95s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 51%|██████████████████████████                         | 43/84 [08:13<09:11, 13.46s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 52%|██████████████████████████▋                        | 44/84 [08:27<08:56, 13.42s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 54%|███████████████████████████▎                       | 45/84 [08:38<08:13, 12.65s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 55%|███████████████████████████▉                       | 46/84 [08:50<08:02, 12.71s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
[Test Error] Test-ID 26422351 e pred
 56%|████████████████████████████▌                      | 47/84 [09:11<09:16, 15.04s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 57%|█████████████████████████████▏                     | 48/84 [09:23<08:25, 14.03s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 58%|█████████████████████████████▊                     | 49/84 [09:35<07:58, 13.67s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 60%|██████████████████████████████▎                    | 50/84 [09:45<07:05, 12.50s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 61%|██████████████████████████████▉                    | 51/84 [10:00<07:15, 13.20s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 62%|███████████████████████████████▌                   | 52/84 [10:15<07:23, 13.87s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 63%|████████████████████████████████▏                  | 53/84 [10:22<06:01, 11.65s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 64%|████████████████████████████████▊                  | 54/84 [10:36<06:13, 12.45s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 65%|█████████████████████████████████▍                 | 55/84 [10:50<06:11, 12.80s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 67%|██████████████████████████████████                 | 56/84 [11:00<05:37, 12.05s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 68%|██████████████████████████████████▌                | 57/84 [11:09<04:57, 11.03s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 69%|███████████████████████████████████▏               | 58/84 [11:22<05:00, 11.56s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 70%|███████████████████████████████████▊               | 59/84 [11:30<04:27, 10.72s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 71%|████████████████████████████████████▍              | 60/84 [11:42<04:24, 11.00s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 73%|█████████████████████████████████████              | 61/84 [11:50<03:50, 10.01s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 74%|█████████████████████████████████████▋             | 62/84 [12:02<03:55, 10.70s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 75%|██████████████████████████████████████▎            | 63/84 [12:09<03:24,  9.73s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 76%|██████████████████████████████████████▊            | 64/84 [12:19<03:16,  9.80s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 77%|███████████████████████████████████████▍           | 65/84 [12:31<03:13, 10.20s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 79%|████████████████████████████████████████           | 66/84 [12:47<03:38, 12.16s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 80%|████████████████████████████████████████▋          | 67/84 [12:56<03:10, 11.23s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 81%|█████████████████████████████████████████▎         | 68/84 [13:05<02:47, 10.48s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 82%|█████████████████████████████████████████▉         | 69/84 [13:12<02:20,  9.39s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 83%|██████████████████████████████████████████▌        | 70/84 [13:21<02:09,  9.28s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 85%|███████████████████████████████████████████        | 71/84 [13:32<02:08,  9.90s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 86%|███████████████████████████████████████████▋       | 72/84 [13:46<02:11, 10.99s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 87%|████████████████████████████████████████████▎      | 73/84 [13:55<01:55, 10.51s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 88%|████████████████████████████████████████████▉      | 74/84 [14:03<01:37,  9.72s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 89%|█████████████████████████████████████████████▌     | 75/84 [14:13<01:27,  9.70s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 90%|██████████████████████████████████████████████▏    | 76/84 [14:30<01:36, 12.05s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 92%|██████████████████████████████████████████████▊    | 77/84 [14:42<01:22, 11.83s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 93%|███████████████████████████████████████████████▎   | 78/84 [14:58<01:19, 13.17s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 94%|███████████████████████████████████████████████▉   | 79/84 [15:07<00:59, 11.94s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 95%|████████████████████████████████████████████████▌  | 80/84 [15:25<00:55, 13.86s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 96%|█████████████████████████████████████████████████▏ | 81/84 [15:33<00:35, 11.88s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 98%|█████████████████████████████████████████████████▊ | 82/84 [15:43<00:22, 11.31s/it]Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.
 99%|██████████████████████████████████████████████████▍| 83/84 [15:54<00:11, 11.26s/it]
100%|███████████████████████████████████████████████████| 84/84 [16:03<00:00, 10.70s/it]

## Finishing Time: 09-11 11:49:58
= = = = = = = = = = = = = = = = = = = =
Done!
